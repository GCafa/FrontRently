<div class="container registration-container">
  <div class="card registration-form">
    <div class="card-body p-4 p-md-5">
      <h2 class="text-center mb-4">Registrazione</h2>
      <form [formGroup]="registerForm" novalidate>
        <!-- Nome -->
        <div class="mb-3">
          <label for="firstName" class="form-label">
            <i class="bi bi-person"></i> Nome
          </label>
          <div class="input-group">
            <span class="input-group-text">
              <i class="bi bi-person-fill"></i>
            </span>
            <input
              type="text"
              class="form-control"
              id="firstName"
              formControlName="firstName"
              [ngClass]="{'is-invalid': submitted && this.f['firstName'].invalid, 'is-valid': submitted && this.f['firstName'].valid}"
              placeholder="Il tuo nome"
            />
          </div>
          <div *ngIf="submitted && this.f['firstName'].errors" class="text-danger mt-1">
            <div *ngIf="this.f['firstName'].errors['required']">Il nome è obbligatorio.</div>
            <div *ngIf="this.f['firstName'].errors['minlength']">Minimo 2 caratteri.</div>
          </div>
        </div>

        <!-- Cognome -->
        <div class="mb-3">
          <label for="lastName" class="form-label">
            <i class="bi bi-person"></i> Cognome
          </label>
          <div class="input-group">
            <span class="input-group-text">
              <i class="bi bi-person-fill"></i>
            </span>
            <input
              type="text"
              class="form-control"
              id="lastName"
              formControlName="lastName"
              [ngClass]="{'is-invalid': submitted && this.f['lastName'].invalid, 'is-valid': submitted && this.f['lastName'].valid}"
              placeholder="Il tuo cognome"
            />
          </div>
          <div *ngIf="submitted && this.f['lastName'].errors" class="text-danger mt-1">
            <div *ngIf="this.f['lastName'].errors['required']">Il cognome è obbligatorio.</div>
            <div *ngIf="this.f['lastName'].errors['minlength']">Minimo 2 caratteri.</div>
          </div>
        </div>

        <!-- Username -->
        <div class="mb-3">
          <label for="username" class="form-label">
            <i class="bi bi-person"></i> Username
          </label>
          <div class="input-group">
            <span class="input-group-text">
              <i class="bi bi-person-fill"></i>
            </span>
            <input
              type="text"
              class="form-control"
              id="username"
              formControlName="username"
              [ngClass]="{'is-invalid': submitted && this.f['username'].invalid, 'is-valid': submitted && this.f['username'].valid}"
              placeholder="Scegli un username"
            />
          </div>
          <div *ngIf="submitted && this.f['username'].errors" class="text-danger mt-1">
            <div *ngIf="this.f['username'].errors['required']">L'username è obbligatorio.</div>
            <div *ngIf="this.f['username'].errors['minlength']">Minimo 2 caratteri.</div>
          </div>
        </div>

        <!-- Email -->
        <div class="mb-3">
          <label for="email" class="form-label">
            <i class="bi bi-envelope"></i> Email
          </label>
          <div class="input-group">
            <span class="input-group-text">
              <i class="bi bi-envelope-fill"></i>
            </span>
            <input
              type="email"
              class="form-control"
              id="email"
              formControlName="email"
              [ngClass]="{'is-invalid': submitted && this.f['email'].invalid, 'is-valid': submitted && this.f['email'].valid}"
              placeholder="esempio@dominio.com"
            />
          </div>
          <div *ngIf="submitted && this.f['email'].errors" class="text-danger mt-1">
            <div *ngIf="this.f['email'].errors['required']">L'email è obbligatoria.</div>
            <div *ngIf="this.f['email'].errors['email']">Formato email non valido.</div>
          </div>
        </div>

        <!-- Password -->
        <div class="mb-3">
          <label for="password" class="form-label">
            <i class="bi bi-lock"></i> Password
          </label>
          <div class="input-group">
            <span class="input-group-text">
              <i class="bi bi-lock-fill"></i>
            </span>
            <input
              type="password"
              class="form-control"
              id="password"
              formControlName="password"
              [ngClass]="{'is-invalid': submitted && this.f['password'].invalid, 'is-valid': submitted && this.f['password'].valid}"
              placeholder="Password"
            />
          </div>
          <div class="form-text">Minimo 6 caratteri.</div>
          <div *ngIf="submitted && this.f['password'].errors" class="text-danger mt-1">
            <div *ngIf="this.f['password'].errors['required']">La password è obbligatoria.</div>
            <div *ngIf="this.f['password'].errors['minlength']">Minimo 6 caratteri.</div>
          </div>
        </div>

        <!-- Conferma Password -->
        <div class="mb-3">
          <label for="confirmPassword" class="form-label">
            <i class="bi bi-lock"></i> Conferma Password
          </label>
          <div class="input-group">
            <span class="input-group-text">
              <i class="bi bi-lock-fill"></i>
            </span>
            <input
              type="password"
              class="form-control"
              id="confirmPassword"
              formControlName="confirmPassword"
              [ngClass]="{'is-invalid': submitted && (this.f['confirmPassword'].invalid || registerForm.errors?.['passwordsMismatch'])}"
              placeholder="Ripeti la password"
            />
          </div>
          <div *ngIf="registerForm.errors?.['passwordsMismatch']">Le password non coincidono.</div>
          <div *ngIf="submitted && (this.f['confirmPassword'].errors || registerForm.errors?.['passwordsMismatch'])" class="text-danger mt-1">
            <div *ngIf="this.f['confirmPassword'].errors?.['required']">Devi confermare la password.</div>
            <div *ngIf="registerForm.errors?.['passwordsMismatch']">Le password non coincidono.</div>
          </div>
        </div>

        <!-- Accetto Termini -->
        <div class="mb-3 form-check">
          <input type="checkbox" class="form-check-input" id="agreeTerms" formControlName="agreeTerms" />
          <label for="agreeTerms" class="form-check-label">
            Accetto i <a href="https://commission.europa.eu/protection-your-personal-data_it" target="_blank">termini e condizioni</a>
          </label>
        </div>
        <div *ngIf="submitted && this.f['agreeTerms'].errors" class="text-danger mb-3">
          Devi accettare i termini per continuare.
        </div>

        <!-- Messaggi di successo/errore -->
        <div *ngIf="successMessage" class="alert alert-success mb-3">
          {{ successMessage }}
        </div>
        <div *ngIf="errorMessage" class="text-danger mb-3">
          {{ errorMessage }}
        </div>

        <!-- Pulsante -->
        <button
          type="button"
          class="btn-register"
          (click)="onSubmit()"
        >
          Registrati
        </button>
      </form>
      <div class="text-center mt-3">
        <p>
          Hai già un account?
          <a routerLink="/login">Accedi</a>
        </p>
      </div>
    </div>
  </div>
</div>
